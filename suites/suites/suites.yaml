variables:
  hp_openstack_ubuntu_precise_image_name: Ubuntu Server 12.04.5 LTS (amd64 20140927) - Partner Image
  hp_openstack_ubuntu_trusty_image_name: Ubuntu Server 14.04.1 LTS (amd64 20140927) - Partner Image
  hp_openstack_centos_image_name: CentOS 6.3 Server 64-bit 20130116
  hp_openstack_region_a_ubuntu_precise: 8ca068c5-6fde-4701-bab8-322b3e7c8d81
  hp_openstack_region_a_ubuntu_trusty: bec3cab5-4722-40b9-a78a-3489218e22fe
  hp_openstack_region_b_ubuntu_precise: 261844b3-479c-5446-a2c4-1ea95d53b668
  hp_openstack_region_b_ubuntu_trusty: 9d25fe2d-cf31-4b05-8c58-f238ec78e633
  hp_openstack_region_b_centos_7_0_docker_1_2: 25bfd0c1-8f20-4e8f-a5cf-36ca825305f2

templates:

  - &packages_provider_config_inputs
    cloudify.server.packages.components_package_url: '{{COMPONENTS_PACKAGE_URL}}'
    cloudify.server.packages.core_package_url: '{{CORE_PACKAGE_URL}}'
    cloudify.server.packages.ui_package_url: '{{UI_PACKAGE_URL}}'
    cloudify.agents.packages.ubuntu_agent_url: '{{UBUNTU_PACKAGE_URL}}'
    cloudify.agents.packages.centos_agent_url: '{{CENTOS_PACKAGE_URL}}'
    cloudify.agents.packages.windows_agent_url: '{{WINDOWS_PACKAGE_URL}}'
    cloudify.workflows.task_retries: '{{WORKFLOW_TASK_RETRIES}}'

  - &manager_blueprint_override
    node_templates.manager.properties.cloudify_packages.agents.ubuntu_agent_url: '{{UBUNTU_PACKAGE_URL}}'
    node_templates.manager.properties.cloudify_packages.agents.centos_agent_url: '{{CENTOS_PACKAGE_URL}}'
    node_templates.manager.properties.cloudify_packages.agents.windows_agent_url: '{{WINDOWS_PACKAGE_URL}}'
    node_templates.manager.properties.cloudify.workflows.task_retries: 20

  - &docker_manager_blueprint_override
    <<: *manager_blueprint_override
    node_templates.manager.properties.cloudify_packages.docker.docker_url: '{{DOCKER_IMAGE_URL}}'

  - &dockerless_manager_blueprint_override
    <<: *manager_blueprint_override
    node_templates.manager.properties.cloudify_packages.server.components_package_url: '{{COMPONENTS_PACKAGE_URL}}'
    node_templates.manager.properties.cloudify_packages.server.core_package_url: '{{CORE_PACKAGE_URL}}'
    node_templates.manager.properties.cloudify_packages.server.ui_package_url: '{{UI_PACKAGE_URL}}'

  ######################################################

  - &openstack_plugin_external
    repo: cloudify-openstack-plugin
    branch: CFY-1850-suites-breakup

  - &softlayer_plugin_external
    repo: cloudify-softlayer-plugin

  - &vsphere_plugin_external
    repo: cloudify-vpshere-plugin
    branch: CFY-1850-suites-breakup
    private: true
    username: opencm
    password: '{{OPENCM_GIT_PWD}}'

  #######################################################

  - &hp_openstack_properties
    ubuntu_image_name: '{{hp_openstack_ubuntu_precise_image_name}}'
    ubuntu_trusty_image_name: '{{hp_openstack_ubuntu_trusty_image_name}}'
    centos_image_name: '{{hp_openstack_centos_image_name}}'
    centos_image_user: root
    flavor_name: standard.small
    small_flavor_id: 101

  - &hp_openstack_region_a_properties
    <<: *hp_openstack_properties
    ubuntu_image_id: '{{hp_openstack_region_a_ubuntu_precise}}'
    ubuntu_trusty_image_id: '{{hp_openstack_region_a_ubuntu_trusty}}'

  - &hp_openstack_region_b_properties
    <<: *hp_openstack_properties
    ubuntu_image_id: '{{hp_openstack_region_b_ubuntu_precise}}'
    ubuntu_trusty_image_id: '{{hp_openstack_region_b_ubuntu_trusty}}'

  #######################################################

  - &hp_openstack_credentials_inputs
    keystone_username: '{{HP_KEYSTONE_USERNAME}}'
    keystone_password: '{{HP_KEYSTONE_PASSWORD}}'

  #######################################################

  - &hp_openstack_region_a_inputs
    region: region-a.geo-1
    image_id: '{{hp_openstack_region_a_ubuntu_trusty}}'

  - &hp_openstack_region_b_inputs
    region: region-b.geo-1
    image_id: '{{hp_openstack_region_a_ubuntu_precise}}'

  - &hp_openstack_dockerless_region_a_inputs
    region: region-a.geo-1
    image_id: '{{hp_openstack_region_b_ubuntu_trusty}}'

  - &hp_openstack_dockerless_region_b_inputs
    region: region-b.geo-1
    image_id: '{{hp_openstack_region_b_ubuntu_precise}}'

  #######################################################

  - &openstack_handler_configuration
    handler: openstack_handler
    external: *openstack_plugin_external

  - &hp_openstack_handler_configuration
    <<: *openstack_handler_configuration
    inputs: inputs-hp-openstack.yaml
    manager_blueprint: openstack-docker/openstack-docker.yaml
    manager_blueprint_override: *docker_manager_blueprint_override

  - &hp_openstack_dockerless_handler_configuration
    <<: *openstack_handler_configuration
    inputs: inputs-hp-openstack.yaml
    manager_blueprint: openstack/openstack.yaml
    bootstrap_using_docker: false
    manager_blueprint_override: *dockerless_manager_blueprint_override

#####################################################################################

handler_configurations:

  hp_openstack_system_tests_region_a:
    <<: *hp_openstack_handler_configuration
    properties: *hp_openstack_region_a_properties
    inputs_override:
      <<: *hp_openstack_credentials_inputs
      <<: *hp_openstack_region_a_inputs
      keystone_tenant_name: cloudify-cosmo-system-tests

  hp_openstack_system_tests_region_b:
    <<: *hp_openstack_handler_configuration
    properties: *hp_openstack_region_b_properties
    inputs_override:
      <<: *hp_openstack_credentials_inputs
      <<: *hp_openstack_region_b_inputs
      keystone_tenant_name: cloudify-cosmo-system-tests

  hp_openstack_system_tests2_region_a:
    <<: *hp_openstack_handler_configuration
    properties: *hp_openstack_region_a_properties
    inputs_override:
      <<: *hp_openstack_credentials_inputs
      <<: *hp_openstack_region_a_inputs
      keystone_tenant_name: cloudify-cosmo-system-tests2

  hp_openstack_system_tests2_region_b:
    <<: *hp_openstack_handler_configuration
    properties: *hp_openstack_region_b_properties
    inputs_override:
      <<: *hp_openstack_credentials_inputs
      <<: *hp_openstack_region_b_inputs
      keystone_tenant_name: cloudify-cosmo-system-tests2

  ############################################################################

  hp_openstack_dockerless_system_tests_region_a:
    <<: *hp_openstack_dockerless_handler_configuration
    properties: *hp_openstack_region_a_properties
    inputs_override:
      <<: *hp_openstack_credentials_inputs
      <<: *hp_openstack_dockerless_region_a_inputs
      keystone_tenant_name: cloudify-cosmo-system-tests

  hp_openstack_dockerless_system_tests_region_b:
    <<: *hp_openstack_dockerless_handler_configuration
    properties: *hp_openstack_region_b_properties
    inputs_override:
      <<: *hp_openstack_credentials_inputs
      <<: *hp_openstack_dockerless_region_b_inputs
      keystone_tenant_name: cloudify-cosmo-system-tests

  hp_openstack_dockerless_system_tests2_region_a:
    <<: *hp_openstack_dockerless_handler_configuration
    properties: *hp_openstack_region_a_properties
    inputs_override:
      <<: *hp_openstack_credentials_inputs
      <<: *hp_openstack_dockerless_region_a_inputs
      keystone_tenant_name: cloudify-cosmo-system-tests2

  hp_openstack_dockerless_system_tests2_region_b:
    <<: *hp_openstack_dockerless_handler_configuration
    properties: *hp_openstack_region_b_properties
    inputs_override:
      <<: *hp_openstack_credentials_inputs
      <<: *hp_openstack_dockerless_region_b_inputs
      keystone_tenant_name: cloudify-cosmo-system-tests2

  #############################################################################

  hp_openstack_centos_system_tests_region_b:
    <<: *hp_openstack_handler_configuration
    properties: *hp_openstack_region_b_properties
    inputs_override:
      <<: *hp_openstack_credentials_inputs
      <<: *hp_openstack_region_b_inputs
      keystone_tenant_name: cloudify-cosmo-system-tests
      image_id: '{{hp_openstack_region_b_centos_7_0_docker_1_2}}'
      manager_server_user: centos

  ############################################################################

  pclab47_devstack_nova_net:
    <<: *openstack_handler_configuration
    handler: openstack_nova_net_handler
    inputs: inputs-nova-net-devstack.yaml
    manager_blueprint: openstack-nova-net/openstack.yaml
    bootstrap_using_docker: false
    manager_blueprint_override: *dockerless_manager_blueprint_override
    properties:
      ubuntu_image_name: ubuntu
      flavor_name: m1.small
      ubuntu_image_id: eada2fe8-894a-4b26-ac8d-cedab010f185
      small_flavor_id: 3

  ###############################################################################

  aws_ec2:
    inputs: cloudify-config-ec2.yaml
    handler: ec2
    bootstrap_using_providers: true
    bootstrap_using_docker: false
    properties:
      medium_instance_type: m1.medium
      ubuntu_agent_ami: ami-a73264ce
    inputs_override:
      <<: *packages_provider_config_inputs
      connection.access_id: '{{AWS_ACCESS_ID}}'
      connection.secret_key: '{{AWS_SECRET_KEY}}'

  ################################################################################

  vsphere:
    inputs: inputs-vsphere.yaml
    handler: vpshere_handler
    external: *vsphere_plugin_external
    manager_blueprint: manager_blueprint/vsphere.yaml
    bootstrap_using_docker: false
    properties:
      template: ubuntu-configured-template
    manager_blueprint_override: *dockerless_manager_blueprint_override
    inputs_override:
      vsphere_username: '{{VSPHERE_USERNAME}}'
      vsphere_password: '{{VSPHERE_PASSWORD}}'
      vsphere_url: '{{VSPHERE_URL}}'
      vsphere_datacenter_name: '{{VCENTER_NAME}}'

  ################################################################################

  softlayer:
    inputs: inputs-softlayer.yaml
    handler: softlayer_handler
    external: *softlayer_plugin_external
    manager_blueprint: softlayer/softlayer.yaml
    bootstrap_using_docker: false
    manager_blueprint_override: *dockerless_manager_blueprint_override
    inputs_override:
      username: '{{SOFTLAYER_USERNAME}}'
      api_key: '{{SOFTLAYER_API_KEY}}'

#####################################################################################

tests:

  openstack_blueprints:
    tests:
      - cosmo_tester/test_suites/test_blueprints

  openstack_blueprints_without_chef_puppet:
    - cosmo_tester/test_suites/test_blueprints -e puppet -e chef

  openstack_chef_puppet_blueprints:
    tests:
      - cosmo_tester/test_suites/test_blueprints/chef_plugin_test.py
      - cosmo_tester/test_suites/test_blueprints/puppet_plugin_test.py

  manager_status:
    tests:
      - cosmo_tester/test_suites/test_manager_status

  openstack_plugin:
    tests:
      - cosmo_tester/test_suites/test_openstack_plugin

  docker_centos:
    tests:
      - cosmo_tester/test_suites/test_docker_centos_env

  ec2_blueprints:
    tests:
      - cosmo_tester/test_suites/ec2_test_blueprints

  vsphere_blueprints:
    tests:
      - cosmo_tester/test_suites/vsphere_test_blueprints

  softlayer_blueprints:
    external: *softlayer_plugin_external
    tests:
      - softlayer_plugin/system_tests/manager
      - softlayer_plugin/system_tests/local

#####################################################################################

test_suites:

  hp_openstack_blueprints_no_chef_puppet:
    handler_configuration: hp_openstack_system_tests_region_a
    tests:
      - openstack_blueprints_without_chef_puppet

  hp_openstack_chef_puppet:
    handler_configuration: hp_openstack_system_tests_region_b
    tests:
      - openstack_blueprints

  hp_openstack_manager_status:
    handler_configuration: hp_openstack_system_tests2_region_a
    tests:
      - manager_status

  hp_openstack_plugin_tests:
    handler_configuration: hp_openstack_system_tests2_region_b
    tests:
      - openstack_plugin

  #####################################################################

  dockerless_hp_openstack_blueprints_no_chef_puppet:
    handler_configuration: hp_openstack_dockerless_system_tests_region_a
    tests:
      - openstack_blueprints_without_chef_puppet

  dockerless_hp_openstack_chef_puppet:
    handler_configuration: hp_openstack_dockerless_system_tests_region_b
    tests:
      - openstack_blueprints

  dockerless_hp_openstack_manager_status:
    handler_configuration: hp_openstack_dockerless_system_tests2_region_a
    tests:
      - manager_status

  dockerless_hp_openstack_plugin_tests:
    handler_configuration: hp_openstack_dockerless_system_tests2_region_b
    tests:
      - openstack_plugin

  #####################################################################

  pclab47_devstack_nova_net:
    handler_configuration: pclab47_devstack_nova_net
    tests:
      - cosmo_tester/test_suites/test_openstack_nova_net

  #####################################################################

  docker_centos_on_openstack:
    handler_configuration: hp_openstack_centos_system_tests_region_b
    tests:
      - cosmo_tester/test_suites/test_docker_centos_env

  ######################################################################

  aws_ec2:
    handler_configuration: aws_ec2
    tests:
      - ec2_blueprints

  ########################################################################

  vsphere:
    handler_configuration: vsphere
    tests:
      - vsphere_blueprints

  ########################################################################

  softlayer:
    handler_configuration: softlayer
    tests:
      - softlayer_blueprints

# these files are created on the client container before executing the tests
# only applies in quickbuild runs, not when running locally
files:
  '~/.ssh/shared-systemt-tests-manager.pem':
    content: '{{SYSTEM_TESTS_MANAGER_KEY}}'
    chmod: 0600
  '~/.ssh/shared-systemt-tests-agent.pem':
    content: '{{SYSTEM_TESTS_AGENT_KEY}}'
    chmod: 0600

# these enviroment variables will be passsed on to the client container
# if they are empty, their values will be the one injected by quickbuild
# only applies in quickbuild runs, not when running locally
env:
  BRANCH_NAME_SYSTEM_TESTS: ''
  BRANCH_NAME_CORE: ''
  BRANCH_NAME_PLUGINS: ''
  SYSTEM_TESTS_MANAGER_KEY: ''
  SYSTEM_TESTS_AGENT_KEY: ''
  OPENCM_GIT_PWD: ''
  CLOUDIFY_AUTOMATION_TOKEN: ''

  COMPONENTS_PACKAGE_URL: ''
  CORE_PACKAGE_URL: ''
  UI_PACKAGE_URL: ''
  UBUNTU_PACKAGE_URL: ''
  CENTOS_PACKAGE_URL: ''
  WINDOWS_PACKAGE_URL: ''
  DOCKER_IMAGE_URL: ''

  VSPHERE_USERNAME: ''
  VSPHERE_PASSWORD: ''
  VSPHERE_URL: ''
  VSPHERE_DATACENTER_NAME: ''

  SOFTLAYER_USERNAME: ''
  SOFTLAYER_API_KEY: ''

  AWS_ACCESS_ID: ''
  AWS_SECRET_KEY: ''

  HP_KEYSTONE_PASSWORD: ''
  HP_KEYSTONE_USERNAME: ''
