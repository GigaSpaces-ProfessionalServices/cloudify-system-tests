tosca_definitions_version: cloudify_dsl_1_0

imports:
    - http://www.getcloudify.org/spec/cloudify/3.2m4/types.yaml

plugins:
  windows_host_plugin:
    source: windows-host-plugin
    executor: host_agent

node_templates:

  vm:
    type: cloudify.nodes.Compute
    properties:
      ip:
      cloudify_agent:
         service:
           successful_consecutive_status_queries_count: 10
           status_transition_sleep_interval: 5
           start_timeout: 240
           stop_timeout: 240
         user: Admin
         password:
    interfaces:
      cloudify.interfaces.worker_installer:
        install: windows_agent_installer.windows_agent_installer.tasks.install
        start: windows_agent_installer.windows_agent_installer.tasks.start
        stop: windows_agent_installer.windows_agent_installer.tasks.stop
        uninstall: windows_agent_installer.windows_agent_installer.tasks.uninstall
        restart: windows_agent_installer.windows_agent_installer.tasks.restart
      cloudify.interfaces.plugin_installer:
        install: windows_plugin_installer.windows_plugin_installer.tasks.install


  app1:
    type: cloudify.nodes.ApplicationModule
    interfaces:
      cloudify.interfaces.lifecycle:
        create: windows_host_plugin.windows_host_plugin.tasks.create1
        configure: scripts/configure1.bat
        start: scripts/start1.py
    relationships:
      -  type: cloudify.relationships.contained_in
         target: vm

  app2:
    type: cloudify.nodes.ApplicationModule
    interfaces:
      cloudify.interfaces.lifecycle:
        create:
          implementation: scripts/create2.ps1
          inputs:
            process:
              command_prefix: powershell
    relationships:
      -  type: cloudify.relationships.contained_in
         target: vm

outputs:
  create1_key:
    value: { get_attribute: [app1, create1_key] }
  configure1_key:
    value: { get_attribute: [app1, configure1_key] }
  start1_key:
    value: { get_attribute: [app1, start1_key] }
  create2_key:
    value: { get_attribute: [app2, create2_key] }
